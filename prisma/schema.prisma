// CMS Nova - Base Schema
// This can be extended in your project's schema.prisma

generator client {
  provider = "prisma-client"
  output   = "./generated"
}

datasource db {
  provider = "postgresql"
}

// --------- USUARIOS Y AUTENTICACIÓN ---------
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  emailVerified Boolean   @default(false) // Boolean como Better Auth v1.3+ espera
  name          String?
  image         String?
  password      String?   // Agregar campo password
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  role          String    @default("user") // Minúsculas como Better Auth espera
  accounts      Account[]
  banned        Boolean   @default(false) // Boolean con default
  banReason     String?
  banExpires    DateTime?
  sessions      Session[]

  @@map("user")
}

model Account {
  id                    String    @id @default(cuid())
  accountId             String
  providerId            String
  userId                String
  accessToken           String?   @db.Text
  refreshToken          String?   @db.Text
  idToken               String?   @db.Text
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?   @db.Text
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  expiresAt             DateTime?

  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([providerId, accountId])
  @@map("account")
}

model Session {
  id             String   @id
  expiresAt      DateTime
  token          String
  createdAt      DateTime
  updatedAt      DateTime
  ipAddress      String?
  userAgent      String?
  userId         String
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  impersonatedBy String?

  @@unique([token])
  @@map("session")
}

model Verification {
  id         String    @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime?
  updatedAt  DateTime?

  @@map("verification")
}

// --------- DESTINOS ---------
model Destination {
  id   String @id @default(cuid())
  name String @unique
}

// --------- CONTENIDO/PLANES ---------
model Plan {
  id                   String   @id @default(cuid())
  mainTitle            String
  articleAlias         String   @unique
  categoryAlias        String
  section              String   @default("planes")
  promotionalText      String   @db.Text
  attractionsTitle     String
  attractionsText      String   @db.Text
  transfersTitle       String
  transfersText        String   @db.Text
  holidayTitle         String
  holidayText          String   @db.Text

  includes             String   @db.Text
  notIncludes          String   @db.Text
  itinerary            Json[]
  priceOptions         Json[]
  generalPolicies      String?  @db.Text
  transportOptions     Json[]
  allowGroundTransport Boolean  @default(false)
  videoUrl             String?
  mainImage            Json?
  published            Boolean  @default(false)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@map("plans")
}

// --------- EXPERIENCIAS ---------
model Experience {
  id            String   @id @default(cuid())
  title         String
  slug          String   @unique
  location      String?
  locationAlias String
  durationType  String   @default("flexible")
  hostName      String?
  hostBio       String?   @db.Text
  summary       String    @db.Text
  narrative     String    @db.Text
  activities    String?   @db.Text
  duration      String?
  schedule      String?
  scheduleDays  Json?
  scheduleNote  String?   @db.Text
  price         String?
  currency      String   @default("COP")
  inclusions    String?  @db.Text
  exclusions    String?  @db.Text
  gallery       Json?
  tags          String?
  featured      Boolean  @default(false)
  published     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([locationAlias])
  @@map("experiences")
}

// --------- ACTIVIDAD Y LOGS ---------
model ActivityLog {
  id          String   @id @default(cuid())
  type        String
  description String
  userId      String?
  userName    String?
  metadata    Json?
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())

  @@map("activity_log")
}

// --------- CONFIGURACIÓN ---------
model NovaConfig {
  id       String @id @default(cuid())
  key      String @unique
  value    Json
  category String @default("general")
  updatedAt DateTime @updatedAt

  @@map("nova_config")
}

// --------- MEDIA / ASSETS ---------
model Asset {
  id        String   @id @default(cuid())
  key       String   @unique
  url       String
  mimeType  String
  size      Int
  width     Int?
  height    Int?
  title     String?
  alt       String?
  folder    String   @default("uploads")
  createdBy String?
  createdAt DateTime @default(now())

  @@map("assets")
}

// --------- CONSTRUCTOR DE CONTENIDO (HEADLESS) ---------

// Modelo para definir un tipo de contenido personalizado (ej: Blog Post, Producto, Evento)
model ContentType {
  id            String    @id @default(cuid())
  name          String    // Nombre legible por humanos (ej: "Post de Blog")
  apiIdentifier String    @unique // Identificador para la API (ej: "blogPost")
  description   String?
  fields        Field[]   // Lista de campos que define este tipo de contenido
  entries       ContentEntry[] // Las entradas de contenido reales de este tipo
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@map("content_types")
}

// Modelo para definir un campo dentro de un tipo de contenido
model Field {
  id              String      @id @default(cuid())
  label           String      // Etiqueta del campo en la UI (ej: "Título del Post")
  apiIdentifier   String      // Identificador para la API (ej: "title")
  type            FieldType   // El tipo de campo (Texto, Número, etc.)
  isRequired      Boolean     @default(false)
  metadata        Json?       // Metadata adicional para el campo (ej: rutas del slug)
  
  contentTypeId   String
  contentType     ContentType @relation(fields: [contentTypeId], references: [id], onDelete: Cascade)

  @@unique([contentTypeId, apiIdentifier])
  @@map("fields")
}

// Modelo para una entrada de contenido real (ej: un post de blog específico)
model ContentEntry {
  id              String      @id @default(cuid())
  contentTypeId   String
  contentType     ContentType @relation(fields: [contentTypeId], references: [id], onDelete: Cascade)
  
  // SEO Optimized columns
  slug            String      @unique
  title           String
  seoOptions      Json?       // Meta Title, Description, Canonical, Featured Image
  
  // Metadata and State
  status          String      @default("draft") // draft, published, archived
  isFeatured      Boolean     @default(false)
  category        String?
  tags            String[]
  publishedAt     DateTime?
  
  // Dynamic fields
  data            Json
  
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@map("content_entries")
}

// Enum para los diferentes tipos de campos que se pueden crear
enum FieldType {
  TEXT
  RICH_TEXT
  NUMBER
  BOOLEAN
  DATE
  MEDIA
  SLUG
  SELECT
}

// --------- REGIONES / UBICACIONES (SMART SLUG) ---------
model Region {
  id         String      @id @default(cuid())
  name       String      @unique
  subRegions SubRegion[]
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt

  @@map("regions")
}

model SubRegion {
  id        String   @id @default(cuid())
  name      String
  regionId  String
  region    Region   @relation(fields: [regionId], references: [id], onDelete: Cascade)
  zones     Zone[]

  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt

  @@unique([name, regionId])
  @@map("sub_regions")
}

model Zone {
  id          String    @id @default(cuid())
  name        String
  subRegionId String
  subRegion   SubRegion @relation(fields: [subRegionId], references: [id], onDelete: Cascade)

  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt

  @@unique([name, subRegionId])
  @@map("zones")
}
